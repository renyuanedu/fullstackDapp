{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Form, Input, Button, Message } from 'semantic-ui-react';\nimport Layout from '../../../components/layout';\nimport Campaign from '../../../ethernum/campaign';\nimport web3 from '../../../ethernum/web3';\nimport { Router, Link } from '../../../routes';\n\nvar CompaignRequestNew = /*#__PURE__*/function (_Component) {\n  _inherits(CompaignRequestNew, _Component);\n\n  var _super = _createSuper(CompaignRequestNew);\n\n  function CompaignRequestNew() {\n    var _this;\n\n    _classCallCheck(this, CompaignRequestNew);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      description: '',\n      errorMessage: '',\n      value: '',\n      recipentAddress: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee() {\n      var campaign, accounts, _this$state, description, value, recipentAddress;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              campaign = Campaign(_this.props.address);\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 4:\n              accounts = _context.sent;\n              _this$state = _this.state, description = _this$state.description, value = _this$state.value, recipentAddress = _this$state.recipentAddress;\n\n              _this.setState({\n                loading: true\n              });\n\n              _context.prev = 7;\n              _context.next = 10;\n              return _regeneratorRuntime.awrap(campaign.methods.createRequest(description, web3.utils.toWei(value, 'ether'), recipentAddress).send({\n                from: accounts[0]\n              }));\n\n            case 10:\n              Router.pushRoute(\"/compaigns/\".concat(_this.props.address, \"/requests\"));\n              _context.next = 16;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](7);\n\n              _this.setState({\n                errorMessage: _context.t0.message\n              });\n\n            case 16:\n              _this.setState({\n                loading: false\n              });\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[7, 13]], Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(CompaignRequestNew, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Layout, null, __jsx(Link, {\n        router: \"/compaigns/\".concat(this.props.address, \"/requests\")\n      }, __jsx(\"a\", null, \"\\u8FD4\\u56DE\")), __jsx(Form, {\n        onSubmit: this.onSubmit,\n        error: !!this.state.errorMessage\n      }, __jsx(Form.Field, null, __jsx(\"label\", null, \"\\u8BF7\\u6C42\\u63CF\\u8FF0\\uFF1A\"), __jsx(Input, {\n        value: this.state.description,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            description: event.target.value\n          });\n        }\n      })), __jsx(Form.Field, null, __jsx(\"label\", null, \"\\u8BF7\\u6C42\\u91D1\\u989D\\uFF1A(ether)\"), __jsx(Input, {\n        value: this.state.value,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            value: event.target.value\n          });\n        }\n      })), __jsx(Form.Field, null, __jsx(\"label\", null, \"\\u53D7\\u76CA\\u4EBA\\u5730\\u5740\\uFF1A\"), __jsx(Input, {\n        value: this.state.recipentAddress,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            recipentAddress: event.target.value\n          });\n        }\n      })), __jsx(Message, {\n        error: true,\n        header: \"\\u9519\\u8BEF\\u63D0\\u793A\\uFF01\",\n        content: this.state.errorMessage\n      }), __jsx(Button, {\n        loading: this.state.loading,\n        primary: true\n      }, \"\\u589E\\u52A0\\u8BF7\\u6C42\")));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(props) {\n      var address;\n      return _regeneratorRuntime.async(function getInitialProps$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              address = props.query.address;\n              return _context2.abrupt(\"return\", {\n                address: address\n              });\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }]);\n\n  return CompaignRequestNew;\n}(Component);\n\nexport default CompaignRequestNew;","map":{"version":3,"sources":["D:/fullstackDapp/pages/compaigns/requests/new.js"],"names":["React","Component","Form","Input","Button","Message","Layout","Campaign","web3","Router","Link","CompaignRequestNew","description","errorMessage","value","recipentAddress","event","preventDefault","campaign","props","address","eth","getAccounts","accounts","state","setState","loading","methods","createRequest","utils","toWei","send","from","pushRoute","message","onSubmit","target","query"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport { Form,Input,Button,Message } from 'semantic-ui-react';\nimport Layout from '../../../components/layout';\nimport Campaign from '../../../ethernum/campaign';\nimport web3 from '../../../ethernum/web3';\nimport {Router,Link} from '../../../routes';\n\nclass CompaignRequestNew extends Component{\n\n  static async getInitialProps(props){\n      const {address} = props.query;\n      return {address}\n  }\n\n\n  state={\n      description:'',\n      errorMessage:'',\n      value:'',\n      recipentAddress:'',\n  }\n\n  onSubmit = async()=>{\n      event.preventDefault();\n\n      const campaign=Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      const {description,value,recipentAddress} = this.state;\n\n      this.setState({loading:true});\n\n      try {\n          await campaign.methods.createRequest(description,web3.utils.toWei(value,'ether'),recipentAddress).send({\n              from:accounts[0],\n\n          });\n          Router.pushRoute(`/compaigns/${this.props.address}/requests`)\n\n\n      } catch (error) {\n        this.setState({errorMessage:error.message});\n\n      }\n      this.setState({loading:false});\n  }\n\n  render(){\n      return (\n          <Layout>\n\n              <Link router={`/compaigns/${this.props.address}/requests`}>\n                  <a>返回</a>\n              </Link>\n\n              <Form onSubmit={this.onSubmit} error={!!this.state.errorMessage}>\n                <Form.Field>\n                      <label>请求描述：</label>\n                      <Input\n                      value={this.state.description}\n                      onChange={event=>this.setState({description:event.target.value})}\n                      />\n                </Form.Field>\n                <Form.Field>\n                      <label>请求金额：(ether)</label>\n                      <Input\n                      value={this.state.value}\n                      onChange={event=>this.setState({value:event.target.value})}\n                      />\n                </Form.Field>\n                <Form.Field>\n                      <label>受益人地址：</label>\n                      <Input\n                      value={this.state.recipentAddress}\n                      onChange={event=>this.setState({recipentAddress:event.target.value})}\n                      />\n                </Form.Field>\n\n\n\n                <Message error header=\"错误提示！\" content={this.state.errorMessage}/>\n                <Button loading={this.state.loading} primary>增加请求</Button>\n              </Form>\n          </Layout>\n\n      );\n  }\n}\n\n\nexport default CompaignRequestNew;\n"]},"metadata":{},"sourceType":"module"}