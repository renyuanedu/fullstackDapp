{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { Form, Input, Button, Message } from \"semantic-ui-react\";\nimport Campaign from \"../ethernum/campaign\";\nimport web3 from \"../ethernum/web3\";\nimport { Router } from \"../routes\";\n\nvar ContributeFrom = /*#__PURE__*/function (_Component) {\n  _inherits(ContributeFrom, _Component);\n\n  var _super = _createSuper(ContributeFrom);\n\n  function ContributeFrom() {\n    var _this;\n\n    _classCallCheck(this, ContributeFrom);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      value: \"\",\n      errorMessage: \"\",\n      loading: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee() {\n      var campaign, accounts;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault(); //构建合约的实例\n\n              campaign = Campaign(_this.props.address);\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 4:\n              accounts = _context.sent;\n\n              _this.setState({\n                loading: true\n              });\n\n              _context.prev = 6;\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(campaign.methods.contribute().send({\n                from: accounts[0],\n                value: web3.utils.toWei(_this.state.value, \"ether\")\n              }));\n\n            case 9:\n              Router.replaceRoute(\"/compaigns/\".concat(_this.props.address));\n              _context.next = 15;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](6);\n\n              _this.setState({\n                errorMessage: _context.t0.message\n              });\n\n            case 15:\n              _this.setState({\n                loading: false\n              });\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[6, 12]], Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(ContributeFrom, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Form, {\n        onSubmit: this.onSubmit,\n        error: !!this.state.errorMessage\n      }, __jsx(Form.Field, null, __jsx(\"label\", null, \"\\u603B\\u7684\\u6295\\u8D44\\u989D\\u5EA6\"), __jsx(Input, {\n        value: this.state.value,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            value: event.target.value\n          });\n        },\n        label: \"ether\",\n        labelPosition: \"right\"\n      })), __jsx(Message, {\n        error: true,\n        header: \"\\u9519\\u8BEF\\u63D0\\u793A\",\n        content: this.state.errorMessage\n      }), __jsx(Button, {\n        loading: this.state.loading,\n        primary: true\n      }, \"\\u6295\\u8D44\"));\n    }\n  }]);\n\n  return ContributeFrom;\n}(Component);\n\nexport default ContributeFrom;","map":{"version":3,"sources":["D:/fullstackDapp/components/contributeForm.js"],"names":["React","Component","Form","Input","Button","Message","Campaign","web3","Router","ContributeFrom","value","errorMessage","loading","event","preventDefault","campaign","props","address","eth","getAccounts","accounts","setState","methods","contribute","send","from","utils","toWei","state","replaceRoute","message","onSubmit","target"],"mappings":";;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAcC,SAAd,QAA8B,OAA9B;AAEA,SAAQC,IAAR,EAAaC,KAAb,EAAmBC,MAAnB,EAA0BC,OAA1B,QAAwC,mBAAxC;AAEA,OAAOC,QAAP,MAAqB,sBAArB;AAEA,OAAOC,IAAP,MAAiB,kBAAjB;AAEA,SAAQC,MAAR,QAAqB,WAArB;;IACMC,c;;;;;;;;;;;;;;;;4DACI;AACNC,MAAAA,KAAK,EAAG,EADF;AAENC,MAAAA,YAAY,EAAC,EAFP;AAGNC,MAAAA,OAAO,EAAC;AAHF,K;;+DAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,cAAAA,KAAK,CAACC,cAAN,GADO,CAEP;;AACMC,cAAAA,QAHC,GAGUT,QAAQ,CAAC,MAAKU,KAAL,CAAWC,OAAZ,CAHlB;AAAA;AAAA,+CAIgBV,IAAI,CAACW,GAAL,CAASC,WAAT,EAJhB;;AAAA;AAIDC,cAAAA,QAJC;;AAKP,oBAAKC,QAAL,CAAc;AAACT,gBAAAA,OAAO,EAAC;AAAT,eAAd;;AALO;AAAA;AAAA,+CAOGG,QAAQ,CAACO,OAAT,CAAiBC,UAAjB,GAA8BC,IAA9B,CAAmC;AACzCC,gBAAAA,IAAI,EAACL,QAAQ,CAAC,CAAD,CAD4B;AAEzCV,gBAAAA,KAAK,EAACH,IAAI,CAACmB,KAAL,CAAWC,KAAX,CAAiB,MAAKC,KAAL,CAAWlB,KAA5B,EAAkC,OAAlC;AAFmC,eAAnC,CAPH;;AAAA;AAWLF,cAAAA,MAAM,CAACqB,YAAP,sBAAkC,MAAKb,KAAL,CAAWC,OAA7C;AAXK;AAAA;;AAAA;AAAA;AAAA;;AAaL,oBAAKI,QAAL,CAAc;AAACV,gBAAAA,YAAY,EAAC,YAAMmB;AAApB,eAAd;;AAbK;AAeT,oBAAKT,QAAL,CAAc;AAACT,gBAAAA,OAAO,EAAC;AAAT,eAAd;;AAfS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;;;;;;6BAkBD;AAAA;;AACN,aACE,MAAC,IAAD;AAAM,QAAA,QAAQ,EAAI,KAAKmB,QAAvB;AAAiC,QAAA,KAAK,EAAI,CAAC,CAAC,KAAKH,KAAL,CAAWjB;AAAvD,SACE,MAAC,IAAD,CAAM,KAAN,QACE,4DADF,EAEE,MAAC,KAAD;AAAO,QAAA,KAAK,EAAI,KAAKiB,KAAL,CAAWlB,KAA3B;AAAkC,QAAA,QAAQ,EAAI,kBAAAG,KAAK;AAAA,iBAAE,MAAI,CAACQ,QAAL,CAAc;AAACX,YAAAA,KAAK,EAACG,KAAK,CAACmB,MAAN,CAAatB;AAApB,WAAd,CAAF;AAAA,SAAnD;AAAgG,QAAA,KAAK,EAAC,OAAtG;AAA8G,QAAA,aAAa,EAAC;AAA5H,QAFF,CADF,EAKE,MAAC,OAAD;AAAS,QAAA,KAAK,MAAd;AAAe,QAAA,MAAM,EAAC,0BAAtB;AAA6B,QAAA,OAAO,EAAE,KAAKkB,KAAL,CAAWjB;AAAjD,QALF,EAME,MAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKiB,KAAL,CAAWhB,OAA5B;AAAqC,QAAA,OAAO;AAA5C,wBANF,CADF;AAUD;;;;EAnC0BX,S;;AAsC7B,eAAeQ,cAAf","sourcesContent":["import React,{Component} from \"react\";\n\nimport {Form,Input,Button,Message} from \"semantic-ui-react\";\n\nimport Campaign from \"../ethernum/campaign\";\n\nimport web3 from \"../ethernum/web3\";\n\nimport {Router} from \"../routes\";\nclass ContributeFrom extends Component{\n  state = {\n    value : \"\",\n    errorMessage:\"\",\n    loading:false\n  };\nonSubmit = async()=>{\n    event.preventDefault();\n    //构建合约的实例\n    const campaign = Campaign(this.props.address);\n    const accounts = await web3.eth.getAccounts();\n    this.setState({loading:true});\n    try{\n        await campaign.methods.contribute().send({\n        from:accounts[0],\n        value:web3.utils.toWei(this.state.value,\"ether\")\n      });\n      Router.replaceRoute(`/compaigns/${this.props.address}`);\n    }catch(error){\n      this.setState({errorMessage:error.message});\n    }\n  this.setState({loading:false});\n}\n\n  render(){\n    return(\n      <Form onSubmit = {this.onSubmit} error = {!!this.state.errorMessage}>\n        <Form.Field>\n          <label>总的投资额度</label>\n          <Input value = {this.state.value} onChange = {event=>this.setState({value:event.target.value})} label=\"ether\" labelPosition=\"right\"/>\n        </Form.Field>\n        <Message error header=\"错误提示\" content={this.state.errorMessage}/>\n        <Button loading={this.state.loading} primary>投资</Button>\n      </Form>\n    );\n  }\n}\n\nexport default ContributeFrom;"]},"metadata":{},"sourceType":"module"}